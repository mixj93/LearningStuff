<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scattered Gallery</title>
    <style type="text/css">
        * { margin: 0; padding: 0; }
        body {
            background-color: #fff;
            color: #555;
            font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
        }

        .wrap {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            
            -webkit-perspective: 800px;
            -moz-perspective: 800px;
            -ms-perspective: 800px;
            perspective: 800px;
        }

        .photo {
            width: 240px;
            height: 360px;
            position: absolute;
            z-index: 1;
            box-shadow: 0 0 1px rgba(0, 0, 0, 0.01);
        }
        .photo .side {
            width: 100%;
            height: 100%;
            background-color: #eee;
            position: absolute;
            top: 0;
            right: 0;
        }
        .photo .side-front {}
        .photo .side-front .image {
            width: 100%;
            height: 300px;
            line-height: 300px;
            text-align: center;
            overflow: hidden;
        }
        .photo .side-front .image img {
            max-width: 100%;
            max-height: 100%;
        }
        .photo .side-front .caption {
            text-align: center;
            padding: 10px;
            font-size: 16px;
        }
        .photo .side-back {}
        .photo .side-back .desc {
            color: #898989;
            line-height: 1.5;
            padding: 20px;
        }

        .photo_center {
            left: 50%;
            top: 50%;
            margin: -180px 0 0 -120px;
            z-index: 999;
        }

        .photo-wrap {
            position: absolute;
            width: 100%;
            height: 100%;

            -webkit-transform-style: preserve-3d;
            -moz-transform-style: preserve-3d;
            -ms-transform-style: preserve-3d;
            transform-style: preserve-3d;
            -webkit-transition: all 0.6s;
            -ms-transition: all 0.6s;
            transition: all 0.6s;
        }
        .photo-wrap .side {
            -webkit-backface-visibility: hidden;
            -moz-backface-visibility: hidden;
            -ms-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .photo-wrap .side-front {
            -webkit-transform: rotateY(0deg);
            -moz-transform: rotateY(0deg);
            -ms-transform: rotateY(0deg);
            transform: rotateY(0deg);
        }
        .photo-wrap .side-back {
            -webkit-transform: rotateY(180deg);
            -moz-transform: rotateY(180deg);
            -ms-transform: rotateY(180deg);
            transform: rotateY(180deg);
        }

        .photo_front .photo-wrap {
            -webkit-transform: rotateY(0deg);
            -moz-transform: rotateY(0deg);
            -ms-transform: rotateY(0deg);
            transform: rotateY(0deg);
        }
        .photo_back .photo-wrap {
            -webkit-transform: rotateY(180deg);
            -moz-transform: rotateY(180deg);
            -ms-transform: rotateY(180deg);
            transform: rotateY(180deg);
        }
    </style>
</head>
<body onselectstart="return false;"><!-- 防止选中图文 -->
    <!-- 2. 改写视图 为模板字符串 -->
    <div class="wrap" id="wrap">
        
    </div>
    
    <script type="text/javascript" src="data.js"></script>
    <script type="text/javascript">
        // 3. 通用函数
        function g (selector) {
            var method = selector.substr(0, 1) == '.' ? 'getElementsByClassName' : 'getElementById';
            return document[method](selector.substr(1));
        }

        // 生成随机数 范围
        function random (range) {
            var max = Math.max( range[0], range[1] );
            var min = Math.min( range[0], range[1] );
            var diff = max - min;
            var number = Math.floor( Math.random()*diff + min );

            return number;
        }

        // 4. 输出所有的海报
        var data = data;
        function addPhotos() {
            //var template = g('#wrap').innerHTML;
            var template = 
                '        <div class="photo photo_front" id="photo_{{index}}" onclick="turn(this)">'+
                '            <div class="photo-wrap">'+
                '                <div class="side side-front">'+
                '                    <div class="image"><img src="images/{{img}}"></div>'+
                '                    <p class="caption">{{caption}}</p>'+
                '                </div>'+
                '                <div class="side side-back">'+
                '                    <p class="desc">{{desc}}</p>'+
                '                </div>'+
                '            </div>    '+
                '        </div>';
            var html = [];

            for(var s in data) {
                var _html = template.replace('{{index}}', s)
                                    .replace('{{img}}', data[s].img)
                                    .replace('{{caption}}', data[s].caption)
                                    .replace('{{desc}}', data[s].desc);

                html.push(_html);
                g('#wrap').innerHTML = html.join('');
            }

            rsort( random([0, data.length]) ); //初始化排序
        }
        addPhotos();

        // 5. 排序海报
        function rsort (n) {
            var photo_center = g('#photo_' + n);
            photo_center.className += ' photo_center';
        }

        // 1. 翻面控制
        function turn (elem) {
            var cls = elem.className;
            if (/photo_front/.test(cls)) {
                cls = cls.replace(/photo_front/, "photo_back");
            } else {
                cls = cls.replace(/photo_back/, "photo_front");
            }

            return elem.className = cls;
        }
    </script>
</body>
</html>